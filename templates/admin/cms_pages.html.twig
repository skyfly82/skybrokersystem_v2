<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <title>CMS Pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; margin:20px;}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap:24px}
    .card{border:1px solid #ddd; border-radius:12px; padding:16px}
    label{display:block; font-size:12px; color:#555; margin-top:12px}
    input,textarea,select{width:100%; padding:8px; border:1px solid #ccc; border-radius:8px}
    table{width:100%; border-collapse:collapse}
    th,td{padding:8px; border-bottom:1px solid #eee; text-align:left}
    button{background:#0d6efd; border:none; border-radius:8px; color:#fff; padding:8px 12px; cursor:pointer; margin-top:12px}
    .row-actions button{background:#ef4444; margin-left:8px}
  </style>
  <script>
    async function loadPages(){
      const r = await fetch('/api/cms/pages?limit=100');
      const list = await r.json();
      const tb = document.querySelector('#pages tbody');
      tb.innerHTML = '';
      list.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.id}</td><td>${p.title}</td><td><code>/${p.slug}</code></td><td>${p.status}</td><td>${p.published_at||''}</td><td class='row-actions'><button onclick="del(${p.id})">Usuń</button></td>`;
        tb.appendChild(tr);
      });
    }
    async function del(id){ if(!confirm('Usunąć stronę #'+id+'?')) return; await fetch('/api/cms/pages/'+id,{method:'DELETE'}); loadPages(); }
    async function submitForm(ev){
      ev.preventDefault();
      const f = ev.target;
      const body = {
        title: f.title.value.trim(),
        slug: f.slug.value.trim(),
        status: f.status.value,
        excerpt: f.excerpt.value,
        content: f.content.value,
        meta_title: f.meta_title.value,
        meta_description: f.meta_description.value
      };
      const r = await fetch('/api/cms/pages',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
      if(r.ok){ alert('Zapisano'); f.reset(); loadPages(); } else { const d=await r.json(); alert('Błąd: '+(d.message||r.status)); }
    }
    addEventListener('DOMContentLoaded', ()=>{ loadPages(); document.getElementById('f').addEventListener('submit', submitForm); });
  </script>
</head>
<body>
  <h1>CMS Pages</h1>
  <div class="grid">
    <section class="card">
      <h3>Lista</h3>
      <table id="pages"><thead><tr><th>ID</th><th>Tytuł</th><th>Slug</th><th>Status</th><th>Opublikowano</th><th></th></tr></thead><tbody></tbody></table>
    </section>
    <section class="card">
      <h3>Nowa strona</h3>
      <form id="f">
        <label>Tytuł<input name="title" required></label>
        <label>Slug<input name="slug" placeholder="np. regulamin" required></label>
        <label>Status<select name="status"><option value="draft">Szkic</option><option value="published">Opublikowana</option><option value="archived">Archiwalna</option></select></label>
        <label>Meta title<input name="meta_title"></label>
        <label>Meta description<textarea name="meta_description" rows="2"></textarea></label>
        <label>Lead<textarea name="excerpt" rows="2"></textarea></label>
        <label>Treść<textarea name="content" rows="8"></textarea></label>
        <button type="submit">Zapisz</button>
      </form>
    </section>
  </div>
</body>
</html>

