<div x-data="{ userMenuOpen: false, notificationsOpen: false }" class="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8">
    <!-- Mobile menu button -->
    <button type="button" class="-m-2.5 p-2.5 text-gray-700 lg:hidden" @click="$dispatch('toggle-sidebar')">
        <span class="sr-only">Open sidebar</span>
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
    </button>

    <!-- Separator -->
    <div class="h-6 w-px bg-gray-200 lg:hidden" aria-hidden="true"></div>

    <!-- Page title and breadcrumbs -->
    <div class="flex flex-1 gap-x-4 self-stretch lg:gap-x-6">
        <div class="relative flex flex-1 items-center">
            <h1 class="text-xl font-semibold leading-6 text-gray-900">
                {% block page_title %}
                    {% if dashboard_type == 'system' %}
                        Dashboard Administratora
                    {% else %}
                        Dashboard Klienta
                    {% endif %}
                {% endblock %}
            </h1>
            
            {% block breadcrumbs %}
                {# Breadcrumbs can be added here for specific pages #}
            {% endblock %}
        </div>
        
        <div class="flex items-center gap-x-4 lg:gap-x-6">
            <!-- Search -->
            <form class="relative flex flex-1" action="#" method="GET">
                <label for="search-field" class="sr-only">Search</label>
                <svg class="pointer-events-none absolute inset-y-0 left-0 h-full w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
                </svg>
                <input id="search-field" 
                       class="block h-full w-full border-0 py-0 pl-8 pr-0 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm" 
                       placeholder="Szukaj..." type="search" name="search">
            </form>

            <!-- Notifications button -->
            <div class="relative">
                <button type="button" 
                        class="-m-2.5 p-2.5 text-gray-400 hover:text-gray-500"
                        @click="notificationsOpen = !notificationsOpen">
                    <span class="sr-only">View notifications</span>
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
                    </svg>
                    <!-- Notification badge -->
                    <span class="absolute -top-1 -right-1 h-4 w-4 rounded-full bg-red-500 text-xs text-white flex items-center justify-center">
                        3
                    </span>
                </button>

                <!-- Notifications dropdown -->
                <div x-show="notificationsOpen" 
                     x-transition:enter="transition ease-out duration-100"
                     x-transition:enter-start="transform opacity-0 scale-95"
                     x-transition:enter-end="transform opacity-100 scale-100"
                     x-transition:leave="transition ease-in duration-75"
                     x-transition:leave-start="transform opacity-100 scale-100"
                     x-transition:leave-end="transform opacity-0 scale-95"
                     @click.away="notificationsOpen = false"
                     class="absolute right-0 z-10 mt-2.5 w-80 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 focus:outline-none"
                     style="display: none;">
                    
                    <div class="px-4 py-3 border-b border-gray-100">
                        <h3 class="text-sm font-medium text-gray-900">Powiadomienia</h3>
                    </div>
                    
                    <div class="max-h-64 overflow-y-auto">
                        {% set notifications = [
                            {
                                id: 1,
                                type: 'order',
                                title: 'Nowe zamówienie',
                                message: 'Otrzymałeś nowe zamówienie #ORD-2025-001',
                                time: '2 min temu',
                                unread: true
                            },
                            {
                                id: 2,
                                type: 'delivery',
                                title: 'Przesyłka dostarczona',
                                message: 'Przesyłka #TRK-123456 została dostarczona',
                                time: '1 godz temu',
                                unread: true
                            },
                            {
                                id: 3,
                                type: 'system',
                                title: 'Aktualizacja systemu',
                                message: 'System zostanie zaktualizowany dziś o 22:00',
                                time: '3 godz temu',
                                unread: false
                            }
                        ] %}
                        
                        {% for notification in notifications %}
                            <a href="#" class="flex px-4 py-3 hover:bg-gray-50 {{ notification.unread ? 'bg-blue-50' : '' }}">
                                <div class="flex-shrink-0">
                                    {% if notification.type == 'order' %}
                                        <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                            <svg class="h-4 w-4 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                        </div>
                                    {% elseif notification.type == 'delivery' %}
                                        <div class="h-8 w-8 rounded-full bg-green-100 flex items-center justify-center">
                                            <svg class="h-4 w-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                            </svg>
                                        </div>
                                    {% else %}
                                        <div class="h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center">
                                            <svg class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="ml-3 flex-1">
                                    <p class="text-sm font-medium text-gray-900">{{ notification.title }}</p>
                                    <p class="text-sm text-gray-500">{{ notification.message }}</p>
                                    <p class="text-xs text-gray-400 mt-1">{{ notification.time }}</p>
                                </div>
                                {% if notification.unread %}
                                    <div class="flex-shrink-0">
                                        <div class="h-2 w-2 rounded-full bg-blue-600"></div>
                                    </div>
                                {% endif %}
                            </a>
                        {% endfor %}
                    </div>
                    
                    <div class="border-t border-gray-100 px-4 py-2">
                        <a href="/dashboard/notifications" class="text-sm text-blue-600 hover:text-blue-500">
                            Zobacz wszystkie powiadomienia
                        </a>
                    </div>
                </div>
            </div>

            <!-- Separator -->
            <div class="hidden lg:block lg:h-6 lg:w-px lg:bg-gray-200" aria-hidden="true"></div>

            <!-- Profile dropdown -->
            <div class="relative">
                <button type="button" 
                        class="-m-1.5 flex items-center p-1.5"
                        @click="userMenuOpen = !userMenuOpen"
                        id="user-menu-button" 
                        aria-expanded="false" 
                        aria-haspopup="true">
                    <span class="sr-only">Open user menu</span>
                    <img class="h-8 w-8 rounded-full bg-gray-50" 
                         src="https://ui-avatars.com/api/?name={{ user.fullName ?? 'User' }}&background=4f46e5&color=fff" 
                         alt="{{ user.fullName ?? 'User' }}">
                    <span class="hidden lg:flex lg:items-center">
                        <span class="ml-4 text-sm font-semibold leading-6 text-gray-900" aria-hidden="true">
                            {{ user.fullName ?? 'User' }}
                        </span>
                        <svg class="ml-2 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </span>
                </button>

                <!-- Profile dropdown menu -->
                <div x-show="userMenuOpen" 
                     x-transition:enter="transition ease-out duration-100"
                     x-transition:enter-start="transform opacity-0 scale-95"
                     x-transition:enter-end="transform opacity-100 scale-100"
                     x-transition:leave="transition ease-in duration-75"
                     x-transition:leave-start="transform opacity-100 scale-100"
                     x-transition:leave-end="transform opacity-0 scale-95"
                     @click.away="userMenuOpen = false"
                     class="absolute right-0 z-10 mt-2.5 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 focus:outline-none"
                     style="display: none;"
                     role="menu" 
                     aria-orientation="vertical" 
                     aria-labelledby="user-menu-button">
                    
                    <a href="/dashboard/profile" 
                       class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50" 
                       role="menuitem">Profil</a>
                    
                    {% if dashboard_type == 'customer' and is_granted('ROLE_SYSTEM_USER') %}
                        <a href="/dashboard?type=system" 
                           class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50" 
                           role="menuitem">Panel administratora</a>
                    {% elseif dashboard_type == 'system' %}
                        <a href="/dashboard?type=customer" 
                           class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50" 
                           role="menuitem">Panel klienta</a>
                    {% endif %}
                    
                    <a href="/dashboard/settings" 
                       class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50" 
                       role="menuitem">Ustawienia</a>
                    
                    <hr class="my-1 border-gray-200">
                    
                    <a href="/logout" 
                       class="block px-3 py-1 text-sm leading-6 text-gray-900 hover:bg-gray-50" 
                       role="menuitem">Wyloguj</a>
                </div>
            </div>
        </div>
    </div>
</div>