{# Determine user type and dashboard type #}
{% set user_type = dashboard_type ?? 'customer' %}
{% set is_mobile = mobile ?? false %}

<div class="flex grow flex-col gap-y-5 overflow-y-auto {{ is_mobile ? 'bg-gray-900 px-6 pb-4' : 'bg-gray-900' }}">
    <div class="flex h-16 shrink-0 items-center {{ is_mobile ? '' : 'px-6' }}">
        <img class="h-8 w-auto" src="{{ asset('images/logo-white.svg') }}" alt="Sky Broker System">
        <span class="ml-3 text-white font-bold text-lg">Sky Broker</span>
    </div>
    
    <nav class="flex flex-1 flex-col {{ is_mobile ? '' : 'px-6' }}">
        <ul role="list" class="flex flex-1 flex-col gap-y-7">
            <li>
                <ul role="list" class="-mx-2 space-y-1">
                    {% if user_type == 'system' %}
                        {# System/Admin Navigation #}
                        {% set navigation = [
                            {
                                name: 'Dashboard',
                                href: '/dashboard?type=system',
                                icon: 'chart-pie',
                                current: app.request.pathinfo == '/dashboard'
                            },
                            {
                                name: 'Zamówienia',
                                href: '/dashboard/orders',
                                icon: 'clipboard-document-list',
                                current: '/dashboard/orders' in app.request.pathinfo,
                                count: 23
                            },
                            {
                                name: 'Klienci',
                                href: '/dashboard/customers',
                                icon: 'users',
                                current: '/dashboard/customers' in app.request.pathinfo
                            },
                            {
                                name: 'Kurierzy',
                                href: '/dashboard/carriers',
                                icon: 'truck',
                                current: '/dashboard/carriers' in app.request.pathinfo
                            },
                            {
                                name: 'Cennik',
                                href: '/dashboard/pricing',
                                icon: 'calculator',
                                current: '/dashboard/pricing' in app.request.pathinfo
                            },
                            {
                                name: 'Faktury',
                                href: '/dashboard/invoices',
                                icon: 'receipt-percent',
                                current: '/dashboard/invoices' in app.request.pathinfo,
                                count: 5
                            },
                            {
                                name: 'Raporty',
                                href: '/dashboard/reports',
                                icon: 'chart-bar',
                                current: '/dashboard/reports' in app.request.pathinfo
                            },
                            {
                                name: 'Ustawienia',
                                href: '/dashboard/settings',
                                icon: 'cog-6-tooth',
                                current: '/dashboard/settings' in app.request.pathinfo
                            }
                        ] %}
                    {% else %}
                        {# Customer Navigation #}
                        {% set navigation = [
                            {
                                name: 'Pulpit',
                                href: '/dashboard?type=customer',
                                icon: 'home',
                                current: app.request.pathinfo == '/dashboard'
                            },
                            {
                                name: 'Nowe zamówienie',
                                href: '/dashboard/orders/create',
                                icon: 'plus-circle',
                                current: '/dashboard/orders/create' in app.request.pathinfo,
                                primary: true
                            },
                            {
                                name: 'Moje zamówienia',
                                href: '/dashboard/orders',
                                icon: 'clipboard-document-list',
                                current: '/dashboard/orders' in app.request.pathinfo and '/create' not in app.request.pathinfo,
                                count: 12
                            },
                            {
                                name: 'Śledzenie',
                                href: '/dashboard/tracking',
                                icon: 'map-pin',
                                current: '/dashboard/tracking' in app.request.pathinfo,
                                count: 3
                            },
                            {
                                name: 'Kalkulator cen',
                                href: '/dashboard/pricing-calculator',
                                icon: 'calculator',
                                current: '/dashboard/pricing-calculator' in app.request.pathinfo
                            },
                            {
                                name: 'Faktury i płatności',
                                href: '/dashboard/billing',
                                icon: 'credit-card',
                                current: '/dashboard/billing' in app.request.pathinfo,
                                urgent: true
                            },
                            {
                                name: 'Historia',
                                href: '/dashboard/history',
                                icon: 'clock',
                                current: '/dashboard/history' in app.request.pathinfo
                            }
                        ] %}
                    {% endif %}

                    {% for item in navigation %}
                        <li>
                            <a href="{{ item.href }}" 
                               class="{{ item.current 
                                   ? 'bg-gray-800 text-white' 
                                   : 'text-gray-300 hover:text-white hover:bg-gray-800' 
                               }} {{ item.primary ?? false 
                                   ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                   : '' 
                               }} group flex gap-x-3 rounded-md p-2 text-sm leading-6 font-semibold transition-colors">
                               
                                <svg class="h-6 w-6 shrink-0 {{ item.current ? 'text-white' : 'text-gray-400 group-hover:text-white' }}" 
                                     fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                    {% if item.icon == 'home' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                                    {% elseif item.icon == 'chart-pie' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
                                    {% elseif item.icon == 'clipboard-document-list' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5c.414 0 .75-.336.75-.75 0-.231-.035-.454-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
                                    {% elseif item.icon == 'users' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                                    {% elseif item.icon == 'truck' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 1-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m15.75 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 1-3 0m3 0h1.125c.621 0 1.125-.504 1.125-1.125V13.5m-6 0V9a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 9v4.5m15.75 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V8.25a2.25 2.25 0 0 1 2.25-2.25h13.5a2.25 2.25 0 0 1 2.25 2.25v7.5Z" />
                                    {% elseif item.icon == 'calculator' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75V18m-7.5-6.75h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V13.5Zm0 2.25h.008v.008H8.25v-.008Zm0 2.25h.008v.008H8.25V18Zm2.498-6.75h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V13.5Zm0 2.25h.007v.008h-.007v-.008Zm0 2.25h.007v.008h-.007V18Zm2.504-6.75h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V13.5ZM8.25 6h7.5v2.25h-7.5V6ZM12 2.25c-1.892 0-3.758.11-5.593.322C5.307 2.7 4.5 3.65 4.5 4.757V19.5a2.25 2.25 0 0 0 2.25 2.25h10.5a2.25 2.25 0 0 0 2.25-2.25V4.757c0-1.108-.806-2.057-1.907-2.185A48.507 48.507 0 0 0 12 2.25Z" />
                                    {% elseif item.icon == 'receipt-percent' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 14.25l6-6m4.5-3.493V21.75l-3.75-1.5-3.75 1.5-3.75-1.5-3.75 1.5V4.757c0-1.108.806-2.057 1.907-2.185A48.507 48.507 0 0112 2.25c2.236 0 4.43.18 6.56.533 1.101.128 1.907 1.077 1.907 2.185v1.51zm-9 2.25h.008v.008H9.75V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm4.125 4.5h.008v.008h-.008V12.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                                    {% elseif item.icon == 'chart-bar' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                                    {% elseif item.icon == 'cog-6-tooth' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                    {% elseif item.icon == 'plus-circle' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                    {% elseif item.icon == 'map-pin' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                                    {% elseif item.icon == 'credit-card' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z" />
                                    {% elseif item.icon == 'clock' %}
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                                    {% endif %}
                                </svg>
                                
                                {{ item.name }}
                                
                                {% if item.count is defined %}
                                    <span class="ml-auto w-9 min-w-max whitespace-nowrap rounded-full bg-gray-600 px-2.5 py-0.5 text-center text-xs font-medium text-white ring-1 ring-inset ring-gray-500">
                                        {{ item.count }}
                                    </span>
                                {% elseif item.urgent is defined and item.urgent %}
                                    <span class="ml-auto flex h-2 w-2">
                                        <span class="animate-ping absolute inline-flex h-2 w-2 rounded-full bg-red-400 opacity-75"></span>
                                        <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
                                    </span>
                                {% endif %}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </li>
            
            {# User info section #}
            <li class="mt-auto">
                <div class="flex items-center gap-x-4 px-2 py-3 text-sm font-semibold leading-6 text-gray-300">
                    <img class="h-8 w-8 rounded-full bg-gray-800" 
                         src="https://ui-avatars.com/api/?name={{ user.fullName ?? 'User' }}&background=4f46e5&color=fff" 
                         alt="{{ user.fullName ?? 'User' }}">
                    <span class="sr-only">Your profile</span>
                    <span aria-hidden="true">{{ user.fullName ?? 'User' }}</span>
                </div>
            </li>
        </ul>
    </nav>
</div>